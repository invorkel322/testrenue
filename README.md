# Тестовое задание Renue

## Краткая информация
Для запуска необходимо выполнить следующие шаги:

1. Запустить Bash скрипт `install.sh` на сервере **host**.
2. Запустить Bash скрипт `setup.sh` на серверах **hosta** и **hostb**.

## Структура серверов и скриптов

| **Сервер** | **Скрипт**     |
|------------|----------------|
| **host**   | `install.sh`   |
| **hosta**  | `setup.sh`     |
| **hostb**  | `setup.sh`     |

## Описание скриптов

### `install.sh`:
- Устанавливает необходимые зависимости и инструменты (например, Ansible).
- Создает публичный SSH-ключ.
- Генерирует файлы конфигурации:
  - `inventory.ini` — инвентарь для Ansible.
  - `playbook.yml` — Ansible playbook для выполнения всех задач настройки.
- Запускает Ansible playbook для настройки серверов.

### `setup.sh`:
- Позволяет ввести публичный SSH-ключ для пользователя **DevOps**.
- Отключает SSH-авторизацию по паролю.
- Настроит авторизацию по SSH-ключам для пользователя **DevOps**.
- Выполнит дополнительные настройки безопасности и сервисов на серверах **hosta** и **hostb**.

## Задачи, решаемые проектом:

1. **Отключение SSH-авторизации по паролю**:
   - На обоих серверах отключена авторизация через пароль.
   - Настроена только авторизация по SSH-ключу для пользователя **DevOps**.

2. **Добавление пользователя DevOps и настройка прав**:
   - Создан пользователь **DevOps** на обоих серверах.
   - Для этого пользователя настроена авторизация по SSH-ключу.
   - У пользователя **DevOps** есть права sudo без пароля.

3. **Настройка Fail2Ban**:
   - На сервере **hostA** настроен Fail2Ban для блокировки на 1 час при 3 неудачных попытках входа за 1 минуту.

4. **Настройка PostgreSQL на сервере hostA**:
   - Установлен PostgreSQL.
   - Созданы базы данных `app` и `custom`.
   - Добавлены пользователи:
     - **app** — полный доступ к базе данных `app`.
     - **custom** — полный доступ к базе данных `custom`.
     - **service** — доступ на чтение ко всем базам данных.

5. **Настройка Nginx на сервере hostB**:
   - На сервере **hostB** установлен Nginx.
   - Настроен проксинг запросов на сайт `https://renue.ru` при обращении к localhost или доменному имени сервера.

6. **Настройка доступа PostgreSQL с сервера hostB**:
   - На сервере **hostA** настроен доступ к PostgreSQL только с сервера **hostB**.
   - На сервере **hostB** закрыт доступ к Nginx с сервера **hostA**.

7. **Настройка бэкапов PostgreSQL**:
   - На сервере **hostA** настроены ежедневные бэкапы PostgreSQL.
   - Бэкапы сохраняются на сервере **hostB**.

## Пример работы

1. Склонировать репозиторий:
```bash
git clone https://github.com/your-repo/renue-devops-task.git
cd renue-devops-task

``bash
На сервере host:

chmod +x install.sh
./install.sh
На серверах hosta и hostb:

# Копируем setup.sh на каждый сервер
``bash
scp setup.sh root@hosta:/tmp/
scp setup.sh root@hostb:/tmp/

# Выполняем setup.sh на каждом сервере
``bash
chmod +x /tmp/setup.sh
/tmp/setup.sh
